# EVA4 Assignment 9 - Praveen Raghuvanshi



- [Github link](https://github.com/praveenraghuvanshi1512/EVA4/blob/Session-9/Session-9/Assignment-9/EVA_4_S9_Praveen_Raghuvanshi_Main.ipynb) 

- [Colab link](https://colab.research.google.com/drive/1ue2KgUlzh2A0HuMDfzbGeFpNuIgCTBoh?authuser=1#scrollTo=mmvSUlfTa1j9)

- Model: Resnet18

- No of parameters: 11,173,962

- No of Epochs : 60

- Best Test Acc: 87.29%

- Code Modularity

  - EVA_4_S9_Praveen_Raghuvanshi_Main.ipynb : It contains main workflow
  - S9_functions.py: It contains all the functions related to setup, train, load dataset etc.
  - models/model.py : It contains Resnet model and custom model 
  - utils.py : It contains helper functions such as progress bar
  - augmentation.py: It contains image augmentations such as albumentations
  - gradcam/gradcam.py: GradCAM and GRADCAM++ implementation
  - gradcam/gradcam_utils.py: Utitlity functions used in GradCAM such as visual_cam
  - Folders:
    - sampleimages: Images from internet on which GradCAM is applied
    - outputs: Outcome of GradCAM

- Logs

  - Best accuracy

    ```python
    Epoch: 59
     [================================================================>]  Step: 96ms | Tot: 56s364ms | Train >> Loss: 0.107 | Acc: 96.460% (48230/50000) 391/391 
     [================================================================>]  Step: 68ms | Tot: 3s556ms | Test >> Loss: 0.550 | Acc: 87.290% (8729/10000) 79/79 
    Training completed
    ```

  - Full

    ```python
    
    Epoch: 0
     [================================================================>]  Step: 94ms | Tot: 55s202ms | Train >> Loss: 1.735 | Acc: 36.540% (18270/50000) 391/391 
     [================================================================>]  Step: 63ms | Tot: 3s498ms | Test >> Loss: 1.502 | Acc: 43.900% (4390/10000) 79/79 
    
    Epoch: 1
     [================================================================>]  Step: 97ms | Tot: 55s652ms | Train >> Loss: 1.383 | Acc: 49.762% (24881/50000) 391/391 
     [================================================================>]  Step: 67ms | Tot: 3s550ms | Test >> Loss: 1.364 | Acc: 53.600% (5360/10000) 79/79 
    
    Epoch: 2
     [================================================================>]  Step: 96ms | Tot: 55s785ms | Train >> Loss: 1.177 | Acc: 57.728% (28864/50000) 391/391 
     [================================================================>]  Step: 64ms | Tot: 3s581ms | Test >> Loss: 0.943 | Acc: 66.370% (6637/10000) 79/79 
    
    Epoch: 3
     [================================================================>]  Step: 96ms | Tot: 55s875ms | Train >> Loss: 1.040 | Acc: 63.016% (31508/50000) 391/391 
     [================================================================>]  Step: 61ms | Tot: 3s580ms | Test >> Loss: 0.949 | Acc: 67.050% (6705/10000) 79/79 
    
    Epoch: 4
     [================================================================>]  Step: 96ms | Tot: 56s221ms | Train >> Loss: 0.921 | Acc: 67.630% (33815/50000) 391/391 
     [================================================================>]  Step: 64ms | Tot: 3s589ms | Test >> Loss: 0.809 | Acc: 72.250% (7225/10000) 79/79 
    
    Epoch: 5
     [================================================================>]  Step: 95ms | Tot: 56s469ms | Train >> Loss: 0.834 | Acc: 70.576% (35288/50000) 391/391 
     [================================================================>]  Step: 72ms | Tot: 3s645ms | Test >> Loss: 0.845 | Acc: 73.270% (7327/10000) 79/79 
    
    Epoch: 6
     [================================================================>]  Step: 93ms | Tot: 56s209ms | Train >> Loss: 0.767 | Acc: 72.972% (36486/50000) 391/391 
     [================================================================>]  Step: 66ms | Tot: 3s573ms | Test >> Loss: 0.605 | Acc: 79.300% (7930/10000) 79/79 
    
    Epoch: 7
     [================================================================>]  Step: 96ms | Tot: 56s423ms | Train >> Loss: 0.706 | Acc: 75.178% (37589/50000) 391/391 
     [================================================================>]  Step: 63ms | Tot: 3s541ms | Test >> Loss: 0.575 | Acc: 80.310% (8031/10000) 79/79 
    
    Epoch: 8
     [================================================================>]  Step: 97ms | Tot: 56s460ms | Train >> Loss: 0.661 | Acc: 76.558% (38279/50000) 391/391 
     [================================================================>]  Step: 63ms | Tot: 3s515ms | Test >> Loss: 0.540 | Acc: 81.520% (8152/10000) 79/79 
    
    Epoch: 9
     [================================================================>]  Step: 100ms | Tot: 56s535ms | Train >> Loss: 0.619 | Acc: 78.134% (39067/50000) 391/391 
     [================================================================>]  Step: 67ms | Tot: 3s590ms | Test >> Loss: 0.559 | Acc: 81.460% (8146/10000) 79/79 
    
    Epoch: 10
     [================================================================>]  Step: 97ms | Tot: 56s65ms | Train >> Loss: 0.572 | Acc: 79.880% (39940/50000) 391/391 
     [================================================================>]  Step: 70ms | Tot: 3s566ms | Test >> Loss: 0.534 | Acc: 82.450% (8245/10000) 79/79 
    
    Epoch: 11
     [================================================================>]  Step: 95ms | Tot: 56s269ms | Train >> Loss: 0.540 | Acc: 81.174% (40587/50000) 391/391 
     [================================================================>]  Step: 63ms | Tot: 3s580ms | Test >> Loss: 0.477 | Acc: 83.700% (8370/10000) 79/79 
    
    Epoch: 12
     [================================================================>]  Step: 95ms | Tot: 55s957ms | Train >> Loss: 0.500 | Acc: 82.408% (41204/50000) 391/391 
     [================================================================>]  Step: 65ms | Tot: 3s480ms | Test >> Loss: 0.519 | Acc: 83.380% (8338/10000) 79/79 
    
    Epoch: 13
     [================================================================>]  Step: 95ms | Tot: 55s965ms | Train >> Loss: 0.477 | Acc: 83.234% (41617/50000) 391/391 
     [================================================================>]  Step: 63ms | Tot: 3s578ms | Test >> Loss: 0.470 | Acc: 84.450% (8445/10000) 79/79 
    
    Epoch: 14
     [================================================================>]  Step: 97ms | Tot: 56s462ms | Train >> Loss: 0.438 | Acc: 84.526% (42263/50000) 391/391 
     [================================================================>]  Step: 64ms | Tot: 3s538ms | Test >> Loss: 0.475 | Acc: 84.930% (8493/10000) 79/79 
    
    Epoch: 15
     [================================================================>]  Step: 96ms | Tot: 56s246ms | Train >> Loss: 0.413 | Acc: 85.446% (42723/50000) 391/391 
     [================================================================>]  Step: 63ms | Tot: 3s571ms | Test >> Loss: 0.481 | Acc: 85.010% (8501/10000) 79/79 
    
    Epoch: 16
     [================================================================>]  Step: 98ms | Tot: 56s126ms | Train >> Loss: 0.392 | Acc: 86.388% (43194/50000) 391/391 
     [================================================================>]  Step: 64ms | Tot: 3s533ms | Test >> Loss: 0.448 | Acc: 85.970% (8597/10000) 79/79 
    
    Epoch: 17
     [================================================================>]  Step: 97ms | Tot: 56s373ms | Train >> Loss: 0.363 | Acc: 87.378% (43689/50000) 391/391 
     [================================================================>]  Step: 64ms | Tot: 3s548ms | Test >> Loss: 0.535 | Acc: 84.510% (8451/10000) 79/79 
    
    Epoch: 18
     [================================================================>]  Step: 96ms | Tot: 55s982ms | Train >> Loss: 0.348 | Acc: 87.792% (43896/50000) 391/391 
     [================================================================>]  Step: 66ms | Tot: 3s563ms | Test >> Loss: 0.477 | Acc: 85.520% (8552/10000) 79/79 
    
    Epoch: 19
     [================================================================>]  Step: 101ms | Tot: 56s74ms | Train >> Loss: 0.322 | Acc: 88.790% (44395/50000) 391/391 
     [================================================================>]  Step: 66ms | Tot: 3s583ms | Test >> Loss: 0.509 | Acc: 84.900% (8490/10000) 79/79 
    
    Epoch: 20
     [================================================================>]  Step: 97ms | Tot: 56s274ms | Train >> Loss: 0.309 | Acc: 89.304% (44652/50000) 391/391 
     [================================================================>]  Step: 63ms | Tot: 3s592ms | Test >> Loss: 0.487 | Acc: 85.660% (8566/10000) 79/79 
    
    Epoch: 21
     [================================================================>]  Step: 95ms | Tot: 56s191ms | Train >> Loss: 0.297 | Acc: 89.738% (44869/50000) 391/391 
     [================================================================>]  Step: 62ms | Tot: 3s532ms | Test >> Loss: 0.499 | Acc: 85.700% (8570/10000) 79/79 
    
    Epoch: 22
     [================================================================>]  Step: 96ms | Tot: 56s277ms | Train >> Loss: 0.280 | Acc: 90.236% (45118/50000) 391/391 
     [================================================================>]  Step: 64ms | Tot: 3s539ms | Test >> Loss: 0.550 | Acc: 84.960% (8496/10000) 79/79 
    
    Epoch: 23
     [================================================================>]  Step: 98ms | Tot: 56s33ms | Train >> Loss: 0.269 | Acc: 90.670% (45335/50000) 391/391 
     [================================================================>]  Step: 67ms | Tot: 3s433ms | Test >> Loss: 0.505 | Acc: 85.740% (8574/10000) 79/79 
    
    Epoch: 24
     [================================================================>]  Step: 100ms | Tot: 56s219ms | Train >> Loss: 0.254 | Acc: 91.360% (45680/50000) 391/391 
     [================================================================>]  Step: 63ms | Tot: 3s591ms | Test >> Loss: 0.494 | Acc: 86.070% (8607/10000) 79/79 
    
    Epoch: 25
     [================================================================>]  Step: 100ms | Tot: 55s797ms | Train >> Loss: 0.238 | Acc: 91.704% (45852/50000) 391/391 
     [================================================================>]  Step: 65ms | Tot: 3s501ms | Test >> Loss: 0.508 | Acc: 86.040% (8604/10000) 79/79 
    
    Epoch: 26
     [================================================================>]  Step: 103ms | Tot: 56s464ms | Train >> Loss: 0.230 | Acc: 92.166% (46083/50000) 391/391 
     [================================================================>]  Step: 66ms | Tot: 3s549ms | Test >> Loss: 0.499 | Acc: 86.410% (8641/10000) 79/79 
    
    Epoch: 27
     [================================================================>]  Step: 97ms | Tot: 56s385ms | Train >> Loss: 0.225 | Acc: 92.246% (46123/50000) 391/391 
     [================================================================>]  Step: 65ms | Tot: 3s572ms | Test >> Loss: 0.546 | Acc: 86.510% (8651/10000) 79/79 
    
    Epoch: 28
     [================================================================>]  Step: 96ms | Tot: 56s565ms | Train >> Loss: 0.223 | Acc: 92.270% (46135/50000) 391/391 
     [================================================================>]  Step: 65ms | Tot: 3s607ms | Test >> Loss: 0.574 | Acc: 85.370% (8537/10000) 79/79 
    
    Epoch: 29
     [================================================================>]  Step: 95ms | Tot: 56s481ms | Train >> Loss: 0.209 | Acc: 92.860% (46430/50000) 391/391 
     [================================================================>]  Step: 66ms | Tot: 4s348ms | Test >> Loss: 0.513 | Acc: 86.400% (8640/10000) 79/79 
    
    Epoch: 30
     [================================================================>]  Step: 93ms | Tot: 57s52ms | Train >> Loss: 0.203 | Acc: 93.052% (46526/50000) 391/391 
     [================================================================>]  Step: 69ms | Tot: 3s616ms | Test >> Loss: 0.546 | Acc: 86.000% (8600/10000) 79/79 
    
    Epoch: 31
     [================================================================>]  Step: 97ms | Tot: 56s935ms | Train >> Loss: 0.197 | Acc: 93.226% (46613/50000) 391/391 
     [================================================================>]  Step: 69ms | Tot: 3s684ms | Test >> Loss: 0.507 | Acc: 86.640% (8664/10000) 79/79 
    
    Epoch: 32
     [================================================================>]  Step: 97ms | Tot: 56s556ms | Train >> Loss: 0.190 | Acc: 93.458% (46729/50000) 391/391 
     [================================================================>]  Step: 68ms | Tot: 3s663ms | Test >> Loss: 0.525 | Acc: 86.040% (8604/10000) 79/79 
    
    Epoch: 33
     [================================================================>]  Step: 97ms | Tot: 56s709ms | Train >> Loss: 0.188 | Acc: 93.554% (46777/50000) 391/391 
     [================================================================>]  Step: 70ms | Tot: 3s584ms | Test >> Loss: 0.528 | Acc: 86.850% (8685/10000) 79/79 
    
    Epoch: 34
     [================================================================>]  Step: 95ms | Tot: 56s258ms | Train >> Loss: 0.177 | Acc: 93.900% (46950/50000) 391/391 
     [================================================================>]  Step: 65ms | Tot: 3s540ms | Test >> Loss: 0.545 | Acc: 85.840% (8584/10000) 79/79 
    
    Epoch: 35
     [================================================================>]  Step: 94ms | Tot: 56s312ms | Train >> Loss: 0.171 | Acc: 94.096% (47048/50000) 391/391 
     [================================================================>]  Step: 66ms | Tot: 3s582ms | Test >> Loss: 0.523 | Acc: 86.560% (8656/10000) 79/79 
    
    Epoch: 36
     [================================================================>]  Step: 104ms | Tot: 56s764ms | Train >> Loss: 0.169 | Acc: 94.144% (47072/50000) 391/391 
     [================================================================>]  Step: 70ms | Tot: 3s564ms | Test >> Loss: 0.506 | Acc: 87.100% (8710/10000) 79/79 
    
    Epoch: 37
     [================================================================>]  Step: 95ms | Tot: 56s539ms | Train >> Loss: 0.168 | Acc: 94.248% (47124/50000) 391/391 
     [================================================================>]  Step: 66ms | Tot: 3s620ms | Test >> Loss: 0.551 | Acc: 85.960% (8596/10000) 79/79 
    
    Epoch: 38
     [================================================================>]  Step: 100ms | Tot: 56s349ms | Train >> Loss: 0.161 | Acc: 94.466% (47233/50000) 391/391 
     [================================================================>]  Step: 63ms | Tot: 3s566ms | Test >> Loss: 0.547 | Acc: 86.420% (8642/10000) 79/79 
    
    Epoch: 39
     [================================================================>]  Step: 97ms | Tot: 56s473ms | Train >> Loss: 0.157 | Acc: 94.592% (47296/50000) 391/391 
     [================================================================>]  Step: 64ms | Tot: 3s561ms | Test >> Loss: 0.546 | Acc: 87.000% (8700/10000) 79/79 
    
    Epoch: 40
     [================================================================>]  Step: 96ms | Tot: 56s778ms | Train >> Loss: 0.152 | Acc: 94.884% (47442/50000) 391/391 
     [================================================================>]  Step: 63ms | Tot: 3s484ms | Test >> Loss: 0.559 | Acc: 86.500% (8650/10000) 79/79 
    
    Epoch: 41
     [================================================================>]  Step: 95ms | Tot: 56s525ms | Train >> Loss: 0.149 | Acc: 94.884% (47442/50000) 391/391 
     [================================================================>]  Step: 68ms | Tot: 3s579ms | Test >> Loss: 0.548 | Acc: 86.410% (8641/10000) 79/79 
    
    Epoch: 42
     [================================================================>]  Step: 93ms | Tot: 56s816ms | Train >> Loss: 0.150 | Acc: 95.004% (47502/50000) 391/391 
     [================================================================>]  Step: 65ms | Tot: 3s575ms | Test >> Loss: 0.532 | Acc: 86.840% (8684/10000) 79/79 
    
    Epoch: 43
     [================================================================>]  Step: 94ms | Tot: 56s693ms | Train >> Loss: 0.142 | Acc: 95.158% (47579/50000) 391/391 
     [================================================================>]  Step: 68ms | Tot: 3s613ms | Test >> Loss: 0.581 | Acc: 85.900% (8590/10000) 79/79 
    
    Epoch: 44
     [================================================================>]  Step: 104ms | Tot: 56s300ms | Train >> Loss: 0.138 | Acc: 95.260% (47630/50000) 391/391 
     [================================================================>]  Step: 64ms | Tot: 3s611ms | Test >> Loss: 0.569 | Acc: 86.230% (8623/10000) 79/79 
    
    Epoch: 45
     [================================================================>]  Step: 97ms | Tot: 56s399ms | Train >> Loss: 0.143 | Acc: 95.108% (47554/50000) 391/391 
     [================================================================>]  Step: 70ms | Tot: 3s670ms | Test >> Loss: 0.538 | Acc: 86.390% (8639/10000) 79/79 
    
    Epoch: 46
     [================================================================>]  Step: 97ms | Tot: 56s428ms | Train >> Loss: 0.133 | Acc: 95.506% (47753/50000) 391/391 
     [================================================================>]  Step: 63ms | Tot: 3s605ms | Test >> Loss: 0.559 | Acc: 86.350% (8635/10000) 79/79 
    
    Epoch: 47
     [================================================================>]  Step: 104ms | Tot: 56s233ms | Train >> Loss: 0.131 | Acc: 95.572% (47786/50000) 391/391 
     [================================================================>]  Step: 65ms | Tot: 3s599ms | Test >> Loss: 0.575 | Acc: 86.830% (8683/10000) 79/79 
    
    Epoch: 48
     [================================================================>]  Step: 94ms | Tot: 56s408ms | Train >> Loss: 0.127 | Acc: 95.566% (47783/50000) 391/391 
     [================================================================>]  Step: 64ms | Tot: 3s449ms | Test >> Loss: 0.555 | Acc: 86.640% (8664/10000) 79/79 
    
    Epoch: 49
     [================================================================>]  Step: 95ms | Tot: 56s330ms | Train >> Loss: 0.127 | Acc: 95.658% (47829/50000) 391/391 
     [================================================================>]  Step: 67ms | Tot: 3s611ms | Test >> Loss: 0.542 | Acc: 86.590% (8659/10000) 79/79 
    
    Epoch: 50
     [================================================================>]  Step: 99ms | Tot: 56s476ms | Train >> Loss: 0.128 | Acc: 95.602% (47801/50000) 391/391 
     [================================================================>]  Step: 65ms | Tot: 3s678ms | Test >> Loss: 0.579 | Acc: 87.000% (8700/10000) 79/79 
    
    Epoch: 51
     [================================================================>]  Step: 96ms | Tot: 56s394ms | Train >> Loss: 0.121 | Acc: 95.790% (47895/50000) 391/391 
     [================================================================>]  Step: 67ms | Tot: 3s485ms | Test >> Loss: 0.563 | Acc: 86.050% (8605/10000) 79/79 
    
    Epoch: 52
     [================================================================>]  Step: 95ms | Tot: 56s526ms | Train >> Loss: 0.123 | Acc: 95.730% (47865/50000) 391/391 
     [================================================================>]  Step: 67ms | Tot: 3s587ms | Test >> Loss: 0.537 | Acc: 87.180% (8718/10000) 79/79 
    
    Epoch: 53
     [================================================================>]  Step: 101ms | Tot: 56s390ms | Train >> Loss: 0.116 | Acc: 96.082% (48041/50000) 391/391 
     [================================================================>]  Step: 68ms | Tot: 3s623ms | Test >> Loss: 0.590 | Acc: 86.240% (8624/10000) 79/79 
    
    Epoch: 54
     [================================================================>]  Step: 99ms | Tot: 56s155ms | Train >> Loss: 0.118 | Acc: 95.934% (47967/50000) 391/391 
     [================================================================>]  Step: 64ms | Tot: 3s551ms | Test >> Loss: 0.544 | Acc: 87.150% (8715/10000) 79/79 
    
    Epoch: 55
     [================================================================>]  Step: 95ms | Tot: 56s342ms | Train >> Loss: 0.113 | Acc: 96.074% (48037/50000) 391/391 
     [================================================================>]  Step: 69ms | Tot: 3s500ms | Test >> Loss: 0.588 | Acc: 86.550% (8655/10000) 79/79 
    
    Epoch: 56
     [================================================================>]  Step: 103ms | Tot: 56s400ms | Train >> Loss: 0.110 | Acc: 96.254% (48127/50000) 391/391 
     [================================================================>]  Step: 68ms | Tot: 3s593ms | Test >> Loss: 0.570 | Acc: 86.820% (8682/10000) 79/79 
    
    Epoch: 57
     [================================================================>]  Step: 103ms | Tot: 56s195ms | Train >> Loss: 0.113 | Acc: 96.092% (48046/50000) 391/391 
     [================================================================>]  Step: 71ms | Tot: 3s484ms | Test >> Loss: 0.550 | Acc: 86.620% (8662/10000) 79/79 
    
    Epoch: 58
     [================================================================>]  Step: 98ms | Tot: 56s299ms | Train >> Loss: 0.107 | Acc: 96.398% (48199/50000) 391/391 
     [================================================================>]  Step: 67ms | Tot: 3s635ms | Test >> Loss: 0.556 | Acc: 86.950% (8695/10000) 79/79 
    
    Epoch: 59
     [================================================================>]  Step: 96ms | Tot: 56s364ms | Train >> Loss: 0.107 | Acc: 96.460% (48230/50000) 391/391 
     [================================================================>]  Step: 68ms | Tot: 3s556ms | Test >> Loss: 0.550 | Acc: 87.290% (8729/10000) 79/79 
    Training completed
    ```

- Actual and GradCAM image

  1. Car with a Girl

     - Original

       <img src=".\sampleimages\car.jpg" alt="Car with a Girl" style="zoom:150%;" />

     - GradCAM

       <img src=".\outputs\car.jpg" alt="Car - GradCAM" style="zoom:300%;" />

  2. Dog

     - Original

       <img src=".\sampleimages\dog.jpg" alt="Dog - Original" style="zoom:150%;" />

     - GradCAM

       <img src=".\outputs\dog.jpg" alt="Dog - GradCAM" style="zoom:300%;" />

- Analysis

  - No of Epochs : 60
  - Batch size : 128
  - Best Train Acc: 96.46%
  - Best Test Acc: 87.29%
  - No Model changes in Resnet18
  - Extra things done
    - Optimizer: Adam
    - Learning rate: 0.001
    - Image augmentation - Albumentations
      - Train
        - HorizontalFlip(p=1)
        - Normalize((0.4914, 0.4822, 0.4465), (0.2023, 0.1994, 0.2010))
        - Cutout(num_holes=1, max_h_size=12, max_w_size=12, fill_value=[0.4914, 0.4822, 0.4465], always_apply=False, p=0.5)
        - RandomContrast(limit=0.2)
        - RandomBrightness(limit=0.2)
        - ShiftScaleRotate(shift_limit=0.0625, scale_limit=0.1,rotate_limit=15, border_mode=cv2.BORDER_REFLECT_101)
      - Test
        - Normalize((0.4914, 0.4822, 0.4465), (0.2023, 0.1994, 0.2010))
  - Train and test acc were converging till epoch 12 and started to diverge post that.
  - There has been a continous increase in train accuracy
  - Test accuracy is fluctuating
  - Gap between train and test acc is 9.17 in last epoch
